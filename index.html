<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>SMADSOT</title>

    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script src="./lib/ol/v5.3.0/ol.js"></script>
    <link rel="stylesheet" href="./lib/ol/v5.3.0/ol.css" />

    <script src="./lib/jquery.min.js"></script>
    <script src="./lib/chart.min.js"></script>

    <script src="./bootstrap/bootstrap.min.js"></script>
    <script src="./bootstrap/dropdowns/dropdowns-enhancement.js"></script>
    <script src="./bootstrap/datepicker/bootstrap-datepicker.js"></script>
    <script src="./bootstrap/dialog/bootstrap-dialog.js"></script>

    <link rel="stylesheet" href="./bootstrap/bootstrap.min.css" />
    <link
      rel="stylesheet"
      href="./bootstrap/dropdowns/dropdowns-enhancement.css"
    />
    <link
      rel="stylesheet"
      href="./bootstrap/datepicker/bootstrap-datepicker.css"
    />
    <link rel="stylesheet" href="./bootstrap/dialog/bootstrap-dialog.css" />

    <link rel="stylesheet" href="./css/estilos.css" />
    <link rel="stylesheet" href="./css/side-menus-fixes.css" />
    <link rel="stylesheet" href="app.css" />

    <style>
      /* Ocultar el layer switcher de OpenLayers */
      .ol-unselectable.ol-control.layer-switcher {
        display: none !important;
      }
    </style>

    <script src="./lib/dom-to-image.js"></script>

    <script type="text/javascript" src="./lib/ol-ext.js"></script>
    <link rel="stylesheet" href="./lib/ol-ext.css" />

    <script src="./lib/ol3-layerswitcher/ol3-layerswitcher.js"></script>
    <link
      rel="stylesheet"
      href="./lib/ol3-layerswitcher/ol3-layerswitcher.css"
    />
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link
      href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700&amp;display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="header-container">
        <div class="top-header">
            <div class="logos-left">
                <img src="./images/header/logo_puebla_gob.png" alt="Puebla Gobierno del Estado 2024-2030" class="gov-logo">
                <img src="./images/header/desarrollo-sustentable-logo.png" alt="Desarrollo Sustentable - Secretar√≠a de Medio Ambiente" class="desarrollo-logo">
            </div>
            <div class="logos-right">
                <div class="campaign-logo">
                    <img src="./images/header/puebla_frases_gob.png" alt="Por Amor a Puebla">
                </div>
            </div>
            <div class = "accesibility-logo">
                <img src="./images/header/logo_accesibilidad.svg" alt="Accesibilidad" onclick="toggleAccessibility()">
                </div>
        </div>
        <nav class="nav-menu">
            <div class="hamburger-menu" onclick="toggleMenu()">
              <div class="bar"></div>
              <div class="bar"></div>
              <div class="bar"></div>
            </div>
            <ul class="nav-links" id="nav-links">
                <li><a href="#" onclick="location.reload()">INICIO</a></li>
                <li><a href="https://smadsot.puebla.gob.mx/quienes-somos" target="_blank">QUIENES SOMOS</a></li>
                <li><a href="https://smadsot.puebla.gob.mx/avisos-de-privacidad">AVISOS DE PRIVACIDAD</a></li>
                <li><a href="#" id="btn_wrf_info">¬øC√ìMO FUNCIONA EL PRON√ìSTICO?</a></li>
                <li class="mobile-only"><a href="#" id="btn_atmos_mobile">Clima</a></li>
                <li class="mobile-only"><a href="#" id="btn_aire_mobile">Calidad del aire</a></li>
                <li class="mobile-only"><a href="#" id="btn_hist_mobile">Pron√≥stico</a></li>
            </ul>
            
        </nav>
        <div class="search-container" id="searchContainer">
            <input type="text" class="search-input" placeholder="Buscar...">
        </div>
    </div>

    <!-- Modal WRF Info -->
    <div class="modal-overlay" id="wrfModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>¬øQu√© es WRF?</h2>
                <button class="modal-close" onclick="closeWRFModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <p><strong>WRF (Weather Research and Forecasting)</strong> es un sistema de modelado num√©rico de √∫ltima generaci√≥n dise√±ado para servir tanto a necesidades de investigaci√≥n atmosf√©rica como de predicci√≥n operacional del tiempo.</p>
                
                <h3>Caracter√≠sticas principales:</h3>
                <ul>
                    <li><strong>Alta resoluci√≥n:</strong> Genera pron√≥sticos meteorol√≥gicos detallados con precisi√≥n espacial y temporal.</li>
                    <li><strong>Versatilidad:</strong> Se utiliza para simulaciones desde escalas locales hasta regionales.</li>
                    <li><strong>Calidad del aire:</strong> Eval√∫a la dispersi√≥n de contaminantes atmosf√©ricos.</li>
                    <li><strong>Predicci√≥n avanzada:</strong> Incorpora f√≠sica atmosf√©rica compleja y asimilaci√≥n de datos.</li>
                </ul>

                <h3>Aplicaciones en Puebla:</h3>
                <p>En el Estado de Puebla, utilizamos el modelo WRF para:</p>
                <ul>
                    <li>Generar pron√≥stico meteorol√≥gico de alta resoluci√≥n.</li>
                    <li>Evaluar la dispersi√≥n de contaminantes atmosf√©ricos.</li>
                    <li>Proporcionar informaci√≥n actualizada para la toma de decisiones informadas.</li>
                    <li>Monitorear la calidad del aire en tiempo real.</li>
                </ul>

                <p class="modal-footer-text">Para m√°s informaci√≥n, visita <a href="https://www.mmm.ucar.edu/weather-research-and-forecasting-model" target="_blank">el sitio oficial de WRF</a>.</p>
            </div>
        </div>
    </div>

    <div class="accessibility-menu" id="accessibilityMenu">
        <div class="accessibility-header">
            <h3>Opciones de accesibilidad</h3>
            <button class="close-btn" onclick="toggleAccessibility()">‚úï</button>
        </div>
        <div class="accessibility-option" onclick="toggleFeature('large-text')">
            <div class="option-icon">‚Üë</div>
            <div class="option-text">Aumentar el tama√±o del texto</div>
        </div>
        <div class="accessibility-option" onclick="toggleFeature('small-text')">
            <div class="option-icon">‚Üì</div>
            <div class="option-text">Disminuir el tama√±o del texto</div>
        </div>
        <div class="accessibility-option" onclick="toggleFeature('large-spacing')">
            <div class="option-icon">‚ñ∂</div>
            <div class="option-text">Aumentar el espaciado del texto</div>
        </div>
        <div class="accessibility-option" onclick="toggleFeature('small-spacing')">
            <div class="option-icon">‚óÄ</div>
            <div class="option-text">Disminuir el espaciado del texto</div>
        </div>
        <div class="accessibility-option" onclick="toggleFeature('inverted')">
            <div class="option-icon">‚óê</div>
            <div class="option-text">Invertir colores</div>
        </div>
        <div class="accessibility-option" onclick="toggleFeature('grayscale')">
            <div class="option-icon">‚óè</div>
            <div class="option-text">Tonos grises</div>
        </div>
        <div class="accessibility-option" onclick="toggleFeature('underline-links')">
            <div class="option-icon">_</div>
            <div class="option-text">Subrayar enlaces</div>
        </div>
        <div class="accessibility-option" onclick="toggleFeature('large-cursor')">
            <div class="option-icon">‚û§</div>
            <div class="option-text">Cursor grande</div>
        </div>
        <div class="accessibility-option" onclick="toggleReadingGuide()" id="readingGuideBtn">
            <div class="option-icon">‚ò∞</div>
            <div class="option-text">Gu√≠a de lectura</div>
            <div class="guide-status" id="guideStatus">Inactivo</div>
        </div>
        <div class="accessibility-option" onclick="toggleTextToSpeech()" id="textToSpeechBtn">
            <div class="option-icon">üîä</div>
            <div class="option-text">Texto a voz</div>
            <div class="tts-status" id="ttsStatus">Inactivo</div>
        </div>
        <div class="accessibility-option" onclick="toggleSpeechToText()" id="speechToTextBtn">
            <div class="option-icon">üé§</div>
            <div class="option-text">Voz a texto</div>
            <div class="stt-status" id="sttStatus">Inactivo</div>
        </div>
    </div>
    <section class="banner" id="banner">
      <div class="banner-content">
        <h1 class="banner-title">
          Pron√≥stico de calidad del aire y clima para el Estado de Puebla para los siguientes 3 d√≠as
        </h1>
      </div>
    </section>

    <div class="row" style="margin: 20px" id="botones1">
      <div class="col-12 col-md-6 mb-4" id="cali">
        <div class="card">
          <a href="#" class="card-link">
            <div
              class="card-img"
              style="
                background-image: url('./images/Tarjetas/nuevo_aire.jpg');
              "
            >
              <div class="card-text">
                <h3>Calidad del aire</h3>
              </div>
            </div>
          </a>
        </div>
      </div>
      
      <div class="col-12 col-md-6 mb-4" id="meteo">
        <div class="card">
          <a href="#" class="card-link">
            <div
              class="card-img"
              style="
                background-image: url('./images/Tarjetas/nuevo_met.jpg');
              "
            >
              <div class="card-text">
                <h3>Clima</h3>
              </div>
            </div>
          </a>
        </div>
      </div>
    </div>


    <div id="app">
      <div id="side-menu" class="side-menu">
        <div class="menu-buttons-group">
          <button class="menu-btn" id="btn_aire" title="Calidad del aire">
            <i class="fa-solid fa-smog"></i> 
            <span class="menu-label">Calidad del aire</span>
            <span class="menu-tooltip">Calidad del aire</span>
          </button>
          <button class="menu-btn" id="btn_atmos" title="Atm√≥sfera">
            <i class="fa-solid fa-temperature-half"></i> 
            <span class="menu-label">Meteorolog√≠a</span>
            <span class="menu-tooltip">Clima</span>
          </button>
        </div>

        <button class="play-btn" id="btn_toggle_animation" title="Reproducir">
          <i class="fa-solid fa-play" id="playIcon"></i>
          <span class="menu-tooltip">Animaci√≥n de pron√≥stico</span>
        </button>

        <button class="back-btn" id="btn_back" title="Volver al inicio" onclick="location.reload()">
          <i class="fa-solid fa-arrow-left"></i>
          <span class="menu-tooltip">Volver al inicio</span>
        </button>
      </div>

      <div id="main-content">
          <div id="map">
            <div class="map-controls">
              <button class="control-btn" id="toggle-controls-btn" title="Control de Capas">
                <i class="fa-solid fa-layer-group"></i>
              </button>
            </div>
        </div>
        
        <!-- Informaci√≥n del D√≠a - Movido de vuelta al mapa -->
        <div id="filter-info">
          <div class="filter-info-variable"></div>
          <div class="permanent-date"></div>
        </div>
        
        <!-- Escala integrada al panel de capas 
        <div id="gradient-container" class="horizontal-mode embedded bottom-floating">
          <div class="gradient-inner">
            <div class="gradient-variable" id="gradient-variable-label">Variable <span id="gradient-units" class="gradient-inline-unit">(unidades)</span></div>
            <canvas id="dynamic-gradient-canvas" class="gradient-bar-horizontal" height="22" width="380"></canvas>
            <div class="gradient-meta-row">
              <div class="gradient-horizontal-values horizontal-values" id="gradient-values"></div>
            </div>
            <div class="gradient-hint" id="gradient-hint" style="text-align:center;margin-top:6px;font-size:16px;font-family:'Poppins',sans-serif;color:#555;letter-spacing:.4px;user-select:none;">
              Haz clic para filtrar &bull; Doble clic para limpiar
            </div>
          </div>
        </div>
        <!-- Agregar despu√©s del gradient-container -->

      </div>
      <div id="hist">
        <!-- Historial Dashboard -->
        <div id="historial-dashboard" style="display:none;">
          
          <!-- Instrucciones de uso -->
          <div class="usage-instructions">
            <h3>C√≥mo usar el pron√≥stico:</h3>
            <ol>
              <li>Seleccione el municipio del que quiere ver el pron√≥stico</li>
              <li>Seleccione el tipo de datos que quiere mostrar (Clima o Calidad del Aire)</li>
              <li>Puede hacer clic en los botones de variables para deshabilitar o habilitar gr√°ficas</li>
            </ol>
          </div>
          
          <div class="dashboard-header">
            <div class="location-selector">
              <label for="hist-cabecera-select">Seleccione un municipio</label>
              <!-- Select original oculto para compatibilidad con menu.js -->
              <select id="hist-cabecera-select" class="form-control" style="display: none;">
                <option value="">Seleccione un municipio</option>
              </select>
              <!-- Combobox visual -->
              <div id="hist-combobox">
                <input type="text" class="form-control" placeholder="Buscar municipio..." autocomplete="off">
                <ul id="hist-combobox-list" style="display: none;"></ul>
              </div>
            </div>
            <div class="data-type-selector">
              <label for="hist-tipo-select">Tipo de datos</label>
              <select id="hist-tipo-select" class="form-control">
                <option value="meteo">Clima</option>
                <option value="chem">Calidad del Aire</option>
              </select>
            </div>
          </div>

          <div class="dashboard-content">
            <!-- Variable Selection Grid -->
            <div class="variables-grid" id="variable-toggles">
              <!-- Variables will be dynamically added here -->
            </div>

            <!-- Main Content Area -->
            <div class="content-wrapper">
              <div id="hist-content">
                <!-- ICA / Franja de calidad del aire: visible en el dashboard hist√≥rico -->
                <div class="ica-legend" style="width:100%;margin-bottom:10px;">
                  <div class="table-responsive" style="width: 100%;">
                    <table class="table table-bordered table-striped" style="text-align: center; width:100%;">
                      <tr>
                        <td class="align-middle" style="width:10%;"><b>Calidad del aire</b></td>
                        <td class="align-middle" style="width:10%;">Buena</td>
                        <td class="align-middle" style="width:10%;">Regular</td>
                        <td class="align-middle" style="width:10%;">Mala</td>
                        <td class="align-middle" style="width:10%;">Muy mala</td>
                        <td class="align-middle" style="width:10%;">Extremadamente Mala</td>
                        <td class="align-middle" style="width:10%;">Peligrosa</td>
                      </tr>
                      <tr>
                        <td><b>Intervalos</b></td>
                        <td class="align-middle" scope="col" style="width: 10%; background-color: rgb(0,228,0);"><b>0-50</b></td>
                        <td class="align-middle" scope="col" style="width: 10%; background-color: rgb(255,255,0);"><b>51-100</b></td>
                        <td class="align-middle" scope="col" style="width: 10%; background-color: rgb(255,126,0);"><b>101-150</b></td>
                        <td class="align-middle" scope="col" style="width: 10%; background-color: rgb(255,0,0); color:white;"><b>151-200</b></td>
                        <td class="align-middle" scope="col" style="width: 10%; background-color: rgb(143,63,151); color:white;"><b>201-300</b></td>
                        <td class="align-middle" scope="col" style="width: 10%; background-color: rgb(153,0,51); color:white;"><b>301-500</b></td>
                      </tr>
                    </table>
                  </div>
                </div>

                <div id="chartsHost" class="charts-grid">
                  <!-- Las gr√°ficas se generar√°n din√°micamente aqu√≠ -->
                </div>
                <div class="stats-container">
                  <h4>Resumen Estad√≠stico</h4>
                  <div class="stats-table-wrapper">
                    <table class="stats-table">
                      <thead>
                        <tr>
                          <th>Variable</th>
                          <th>Promedio</th>
                          <th>M√°ximo</th>
                          <th>M√≠nimo</th>
                          <th>Unidades</th>
                        </tr>
                      </thead>
                      <tbody id="histStatsTable">
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Side menu derecho para filtros y controles -->
      <div id="side-menu-right" class="side-menu-right">

        <!-- 1. Weather Control (primero) -->
        <div class="control-section">
           <!--<h4>Weather Control</h4>-->
          <div class="weather-controls" id="weather-controls">
            <div class="controls-header" style="font-size: 1.2em; font-weight: bold;">
              <h3 id="controls-header-title"></h3>
              <button class="close-btn" id="close-controls-btn" title="Cerrar panel">&times;</button>
            </div>

            <div class="controls-body">
              <div class="control-group" style="font-size: 1.2em; font-weight: bold; text-align: center; margin-bottom: 10px;">
                <label id="panel-header-text" style="font-size: 1.2em; font-weight: bold;">Pron√≥stico de Clima para el Estado de Puebla</label>
              </div>
              
              <div class="control-group" style="display:none;">
                <label for="select_run">Fecha de Pron√≥stico</label>
                <select id="select_run"></select>
              </div>
               

              <div class="control-group">
                <label>Par√°metros</label>
                <div class="layer-buttons" id="parameter-buttons"></div>
              </div>

              <div class="control-group" id="variables-container" style="display: none;">
                <label for="select_var">Variables</label>
                <select id="select_var"></select>
              </div>
              
              <div class="control-group">
              <div id="gradient-container" >
                <label>Filtro</label>
                <div class="gradient-inner">
                  <canvas id="dynamic-gradient-canvas" class="gradient-bar-horizontal" height="22" width="380"></canvas>
                </div>
              </div>
              </div>

              <!-- Controls Footer -->
              <div class="controls-footer">
                <button class="footer-btn" id="btn_glo">
                  <i class="fa-solid fa-book"></i> Glosario
                </button>
                <button class="footer-btn" id="btn_datos">
                  <i class="fa-solid fa-download"></i> Datos por Municipio
                </button>
                <button class="footer-btn" id="btn_recarga">
                  <i class="fa-solid fa-reload"></i> Limpiar Filtro
                </button>
                <button class="footer-btn" id="btn_hist" title="Pron√≥stico">
                  <i class="fa-solid fa-chart-line"></i> Pron√≥stico
                </button>
              </div>

              <!-- Slot para Buscar Municipio en m√≥vil (despu√©s de botones) -->
              <div id="search-mobile-slot" class="search-mobile-slot"></div>
              
              <!-- Slot para Simbolog√≠a en m√≥vil (despu√©s de b√∫squeda) -->
              <div id="legend-mobile-slot" class="legend-mobile-slot"></div>
            </div>
          </div>
        </div>
        
        <!-- 2. Buscar Municipio (segundo) -->
        <div class="control-section" id="search-section">
          <h4>Buscar Municipio</h4>
          <div id="municipio-map-control">
            <select id="map-search" class="form-control" style="display: none;">
              <option value="">Seleccione un municipio</option>
            </select>
          </div>
        </div>
        
        <!-- 3. Simbolog√≠a (tercero/√∫ltimo) -->
        <div class="control-section" id="legend-section">
          <h4>Simbolog√≠a</h4>
          <div class="legend-content" id="legend-content">
            <div class="legend-item">
              <div class="legend-symbol">
                <svg width="20" height="20" viewBox="0 0 20 20">
                  <circle cx="10" cy="10" r="8" fill="#5a1b30" stroke="#c19862" stroke-width="2"/>
                </svg>
              </div>
              <span>Estaciones de Monitoreo</span>
            </div>
            <div class="legend-item">
              <div class="legend-symbol">
                <svg width="20" height="20" viewBox="0 0 20 20">
                  <polygon points="10,2 18,18 2,18" fill="#c19862" stroke="#fff" stroke-width="2"/>
                </svg>
              </div>
              <span>Cabeceras Municipales</span>
            </div>
            <div class="legend-hint">
              <svg width="16" height="16" viewBox="0 0 16 16" style="vertical-align: middle; margin-right: 4px;">
                <circle cx="8" cy="8" r="7" fill="none" stroke="#c19862" stroke-width="1.5"/>
                <text x="8" y="11.5" text-anchor="middle" font-size="10" font-weight="bold" fill="#c19862">i</text>
              </svg>
              <span>Haz clic sobre las cabeceras o estaciones para ver datos</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-overlay" id="riesgosModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Comunicaci√≥n de riesgos</h2>
                <button class="modal-close" onclick="closeRiesgosModal()">‚úï</button>
            </div>
            <div class="modal-body">
                
                <table class="table table-bordered table-riesgos">
                    <thead>
                        <tr>
                            <th>Categor√≠a</th>
                            <th>Riesgos a la salud</th>
                            <th>Recomendaciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background-color: #00e400;">
                            <td><strong>Buena</strong></td>
                            <td>Existe poco o ning√∫n riesgo para la salud.</td>
                            <td>Se puede realizar cualquier actividad al aire libre.</td>
                        </tr>
                        <tr style="background-color: #ffff00;">
                            <td><strong>Regular</strong></td>
                            <td>Los grupos susceptibles pueden presentar s√≠ntomas en la salud.</td>
                            <td>Las personas que son extremadamente susceptibles a la contaminaci√≥n deben considerar limitar la exposici√≥n al aire libre.</td>
                        </tr>
                        <tr style="background-color: #ff7e00;">
                            <td><strong>Mala</strong></td>
                            <td>Alto. Los grupos susceptibles presentan efectos en la salud.</td>
                            <td>Los ni√±os, adultos mayores, personas que realizan actividad f√≠sica intensa o con enfermedades respiratorias y cardiovasculares, deben evitar la exposici√≥n al aire libre y el resto de la poblaci√≥n deben limitar la exposici√≥n al aire libre.</td>
                        </tr>
                        <tr style="background-color: #ff0000; color: white;">
                            <td><strong>Muy Mala</strong></td>
                            <td>Muy alto. Toda la poblaci√≥n puede presentar efectos en la salud; quienes pertenecen a los grupos susceptibles experimentan efectos graves.</td>
                            <td>Los ni√±os, adultos mayores, personas que realizan actividad f√≠sica intensa o con enfermedades respiratorias y cardiovasculares, deben evitar la exposici√≥n al aire libre.</td>
                        </tr>
                        <tr style="background-color: #8f3f97; color: white;">
                            <td><strong>Extremadamente Mala</strong></td>
                            <td>Extremadamente alto. Toda la poblaci√≥n tiene probabilidades de experimentar efectos graves en la salud.</td>
                            <td>Toda la poblaci√≥n debe evitar la exposici√≥n al aire libre.</td>
                        </tr>
                        <tr style="background-color: #990033; color: white;">
                            <td><strong>Peligrosa</strong></td>
                            <td>Peligro. Toda la poblaci√≥n experimenta efectos graves en la salud.</td>
                            <td>Suspensi√≥n de actividades al aire libre.</td>
                        </tr>
                    </tbody>
                </table>
                <p class="modal-footer-text">Referencia: NADF-009-AIRE-2017</p>

            </div>
        </div>
    </div>
  </body>
  <canvas id="filter-canvas" style="display: none"></canvas>
  <!-- Gu√≠a de lectura -->
  <div id="readingGuide" class="reading-guide" style="display: none;"></div>
  <script src="./defines.js"></script>
  <script src="./lienzo.js"></script>
  <script src="./utils.js"></script>
  <script src="./app.js"></script>
  <script src="./menu.js"></script>
  <script src="./accesibility.js"></script>
  </html>